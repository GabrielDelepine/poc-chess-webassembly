<!DOCTYPE html>
<html>
  <!-- widthwd
- comment connecter GUI à chess.js
- comment charger chess.js en ESM ? (article expliquant comment s'y prendre ? stratégy PR de Vite.js ?)
- Y'a-t-il un projet mieux que chess.js à utiliser en WebAssembly?
- Charger le webAssembly de stockFish
- Comment connecter GUI à stockFish
- trouver une belle image de backgroup (AI generated ?)
dwwddw -->
  <head>
    <meta charset="utf-8" />
    <title>POC Chess WebAssembly</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/chessground@8.3.7/assets/chessground.base.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/chessground@8.3.7/assets/chessground.brown.css"
    />
    <!-- Board theme -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/chessground@8.3.7/assets/chessground.cburnett.css"
    />
    <!-- Pieces theme -->

    <style>
      #chessground {
        width: 500px;
        height: 500px;
      }
      section {
        margin-bottom: 0.6em;
      }
    </style>

    <script src="../node_modules/stockfish.wasm/stockfish.js"></script>

    <script type="importmap">
      {
        "imports": {
          "chessground": "../node_modules/chessground/chessground.js",
          "chess.js": "../node_modules/chess.js/dist/chess.js",
          "standalone-web-chess": "../dist/index.js"
        }
      }
    </script>
    <script defer type="module">
      import {
        StandaloneWebChess,
        SUPPORTED_ENGINES,
      } from "standalone-web-chess"

      const instance = new StandaloneWebChess(
        document.getElementById("chessground")
      )

      // engine selection

      const enginesSelect = document.getElementById("engine")

      for (const engineName of ["", ...SUPPORTED_ENGINES]) {
        const option = document.createElement("option")
        option.setAttribute("name", engineName)
        option.innerText = engineName

        if (engineName === instance.currentEngineName) {
          option.setAttribute("selected", "selected")
        }

        enginesSelect.appendChild(option)
      }

      enginesSelect.addEventListener("change", (event) => {
        const engineName = event.target.value
        instance.changeEngine(!engineName ? undefined : engineName) // TODO listen to promise to disable select, display loading and error
      })

      // engine speed
      instance.addEventListener("engineReturns", ({ duration }) => {
        document.getElementById(
          "duration"
        ).innerText = `(last engine move took ${duration}ms)` // todo improve
      })
    </script>
  </head>

  <body>
    <section>
      <label name="engine">
        Chess engine:
        <select id="engine"></select>
      </label>
      <span id="duration"></span>
    </section>
    <section>
      <div id="chessground"></div>
    </section>

    <noscript>Please enable Javascript</noscript>
  </body>
</html>
